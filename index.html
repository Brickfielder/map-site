<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UK Cardiac Arrest Centres Map</title>
    <!-- Leaflet CSS -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
    <style>
      html, body {
        height: 100%;
        margin: 0;
      }
      #map {
        width: 100%;
        height: 100%;
      }
      .popup-content {
        font-family: Arial, sans-serif;
        font-size: 14px;
        line-height: 1.4;
      }
      .popup-content strong {
        font-size: 16px;
      }
      .popup-section {
        margin-bottom: 8px;
      }
    </style>
</head>
<body>
    <div id="map"></div>
    <div id="controls" style="position: absolute; top: 10px; left: 50px; z-index: 1000; background: rgba(255,255,255,0.95); padding: 6px 10px; border-radius: 8px; box-shadow: 0 0 6px rgba(0,0,0,0.3); display:flex; gap:10px; align-items:center; flex-wrap:wrap;">
  <input type="text" id="search-box" placeholder="Search services..." style="width: 220px; padding: 6px 8px; font-size: 14px; border:1px solid #ddd; border-radius:6px;" list="services-list" />
  <datalist id="services-list"></datalist>
  <label for="status-filter" style="font-size:14px; color:#333;">Status:</label>
  <select id="status-filter" style="padding:6px 8px; font-size:14px; border:1px solid #ddd; border-radius:6px;">
    <option value="all">All</option>
    <option value="unconfirmed">Unconfirmed</option>
    <option value="confirmed by service">Confirmed by service</option>
  </select>
</div>
    <!-- Leaflet JS -->
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
      const hospitals = [
        // Same hospital dataset as before
      ];

      const charities = [
        // Same charities dataset as before
      ];

      // Status options now simplified to "Unconfirmed" and "Confirmed by service"
      const statusOptions = [
        "Unconfirmed",
        "Confirmed by service"
      ];

      const map = L.map('map').setView([54.5, -3], 6);

      L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
        attribution: '¬© OpenStreetMap contributors'
      }).addTo(map);

      const hospitalIcon = L.divIcon({
        html: '<span style="font-size:24px">üè•</span>',
        className: '',
        iconSize: [24, 24],
        iconAnchor: [12, 12],
        popupAnchor: [0, -12]
      });

      const charityIcon = L.divIcon({
        html: '<span style="font-size:24px">üíó</span>',
        className: '',
        iconSize: [24, 24],
        iconAnchor: [12, 12],
        popupAnchor: [0, -12]
      });

      const markersLayer = new L.LayerGroup().addTo(map);
const allMarkers = [];
let currentStatusFilter = 'all';
function applyFilters(){
  allMarkers.forEach(function(it){
    var show = (currentStatusFilter === 'all') || (it.status === currentStatusFilter);
    if(show){ markersLayer.addLayer(it.marker); } else { markersLayer.removeLayer(it.marker); }
  });
}

      hospitals.forEach(hospital => {
        const marker = L.marker([hospital.lat, hospital.lng], {
          icon: hospitalIcon,
          title: hospital.name
        });
        const popupContent = `
          <div class="popup-content">
            <div class="popup-section"><strong>${hospital.name}</strong></div>
            <div class="popup-section"><em>Status:</em> ${statusOptions[0]}</div>
            <div class="popup-section"><em>Eligibility:</em> ${hospital.eligibility}</div>
            <div class="popup-section"><em>Description:</em> Hospital providing specialist cardiac arrest care.</div>
            <div class="popup-section"><em>Contact:</em> Tel: <a href="tel:${hospital.phone.replace(/\s+/g, '')}">${hospital.phone}</a></div>
            <div class="popup-section"><em>Source:</em> N/A</div>
          </div>
        `;
        marker.bindPopup(popupContent);
        markersLayer.addLayer(marker);
        allMarkers.push({ name: hospital.name, marker: marker });
      });

      charities.forEach(org => {
        const marker = L.marker([org.lat, org.lng], {
          icon: charityIcon,
          title: org.name
        });
        const popupContent = `
          <div class="popup-content">
            <div class="popup-section"><strong>${org.name}</strong></div>
            <div class="popup-section"><em>Status:</em> ${statusOptions[1]}</div>
            <div class="popup-section"><em>Description:</em> ${org.description}</div>
            <div class="popup-section"><em>Contact:</em> ${org.contact}</div>
            <div class="popup-section"><em>Source:</em> <a href="${org.sourceLink}" target="_blank">${org.sourceLink}</a></div>
          </div>
        `;
        marker.bindPopup(popupContent);
        markersLayer.addLayer(marker);
        allMarkers.push({ name: org.name, marker: marker });
});

// ===== Assign default statuses (survivors & families only) =====
// We are removing crowd-sourced status; only two values are allowed:
// 'unconfirmed' and 'confirmed by service'. Default everything to 'unconfirmed'.
allMarkers.forEach(function(it){ it.status = 'unconfirmed'; });
const servicesList = document.getElementById('services-list');
allMarkers.forEach(function(item){
  var opt = document.createElement('option');
  opt.value = item.name;
  servicesList.appendChild(opt);
});

const searchBox = document.getElementById('search-box');
function performSearch() {
  const query = searchBox.value.trim().toLowerCase();
  if (!query) return;
  const match = allMarkers.find(function(item){ return item.name.toLowerCase().indexOf(query) !== -1; });
  if (match) {
    const latlng = match.marker.getLatLng();
    map.setView(latlng, 11);
    match.marker.openPopup();
  }
}
searchBox.addEventListener('change', performSearch);
searchBox.addEventListener('keyup', function(e) {
  if (e.key === 'Enter') {
    performSearch();
  }
});

// Status filter (only 'unconfirmed' and 'confirmed by service')
const statusFilter = document.getElementById('status-filter');
statusFilter.addEventListener('change', function(){
  currentStatusFilter = statusFilter.value;
  applyFilters();
});

// Initial render with current filter
applyFilters();
    </script>
</body>
</html>
